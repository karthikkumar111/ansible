# Update system
sudo dnf update -y

# Create ansible user
sudo useradd ansible

# Set password (optional, but SSH key preferred)
sudo passwd ansible

# Allow passwordless sudo for ansible
visudo
#passte the lines on 101 line
ansible ALL=(ALL) NOPASSWD:ALL

#changing the configuration
sudo vim /etc/ssh/sshd_config
#go to 65line
PasswordAuthentication yes


#restart sshd
sudo systemctl restart sshd


# Install Ansible
sudo dnf install ansible-core -y

# Verify installation
ansible --version

#Create Ansible config directory
sudo mkdir -p /etc/ansible
sudo touch /etc/ansible/ansible.cfg
sudo touch /etc/ansible/hosts


#configure the ansible.cfg
sudo vi /etc/ansible/ansible.cfg
#paste this lines
[defaults]
inventory = /etc/ansible/hosts
remote_user = ansible
host_key_checking = False
retry_files_enabled = False

sudo vim /etc/ansible/hosts
#group 1 (dev)
[webservers]
<slave private ip address>
<slave private ip address>
<slave private ip address>

#group 2 (ops)
[webservers]
<slave private ip address>
<slave private ip address>

#switch to ansible user
su - ansible

#generate key
ssh-keygen

#ssh key copying to slave instances
ssh-copy-id ansible@<slaveprivateip>





#change nano to vim editor
#export EDITOR=vim
#Then reload:
#source ~/.bashrc

#switch from ansible user to root user
#exit




#how to check, how many slave servers are connected with ansible(master)
ansible all --list-hosts

#how to check, only particular group servers are connected with ansible(master)
ansible <group name> --list-hosts

#how to check, 3rd server out of all servers are connected with ansible(master)
ansible all(2) --list-hosts

#how to check all servers are connected successfully
#should be in ansible user (su - ansible) not on root user
ansible all -m ping
yes

#BASIC PLAYBOK (written in YAML language on master server)
#create a YAML file
vim abc.yml

#all yaml file starts with "---" and ends with "..."

---
#TARGET SECTION ( trick : T-HUB CONNECTION)
- hosts: dev, ops
  remote_user: ansible
  become: yes
  connection: ssh

  #TASKS SECTION
  tasks:
    - name: I am installing git in slave servers
      dnf:
        name: git
        state: present
...

#execute the playbook
ansible-playbook <filename.yml>

